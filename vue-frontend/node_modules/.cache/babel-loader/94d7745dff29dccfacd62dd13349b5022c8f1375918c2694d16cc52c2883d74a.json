{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nexport default {\n  data() {\n    return {\n      userName: '',\n      message: '',\n      content: '',\n      member: '',\n      users: [],\n      messages: []\n    };\n  },\n  created() {\n    this.userName = sessionStorage.getItem('username');\n  },\n  mounted() {\n    this.initWebSocket();\n  },\n  methods: {\n    initWebSocket() {\n      const wsuri = 'ws://120.55.194.201:8085/websocket/' + this.userName;\n      this.websock = new WebSocket(wsuri);\n      this.websock.onmessage = this.websocketonmessage;\n      this.websock.onopen = this.websocketonopen;\n      this.websock.onerror = this.websocketonerror;\n      this.websock.onclose = this.websocketclose;\n    },\n    //Send messages\n    websocketsend() {\n      let message = {\n        from: this.userName,\n        to: \"Tom\",\n        text: this.message\n      };\n      this.websock.send(JSON.stringify(message));\n      this.messages.push({\n        user: this.userName,\n        text: this.message\n      });\n      this.addNewContent(null, 'You', this.message);\n      this.message = '';\n    },\n    websocketonopen() {\n      console.log(\"Open WebSocket successfully\");\n    },\n    //Reconnect the websocket if it is not opened successfully\n    websocketonerror() {\n      this.initWebSocket();\n    },\n    //Receive messages\n    websocketonmessage(msg) {\n      console.log(msg.data);\n      let data = JSON.parse(msg.data);\n      if (data.users) {\n        //online users\n        for (var key in data.users) {\n          if (this.users == '') {\n            this.addNewMember(data.users[key]['username']);\n          }\n          for (var user in this.users) {\n            console.log(this.users[user]['username']);\n            if (data.users[key]['username'] != this.users[user]['username']) this.addNewMember(data.users[key]['username']);\n          }\n        }\n        this.users = data.users;\n      } else {\n        if (data.from != this.userName) this.addNewContent(data.from, null, data.text);\n      }\n    },\n    //Close the websocket\n    websocketclose() {\n      this.websock.close();\n    },\n    //Add chatting content of team members to the chat box\n    addNewContent(remoteSender, sender, text) {\n      let html;\n      if (sender) {\n        html = \"<div class=\\\"card\\\">\\n\" + \"<div class=\\\"card-header d-flex justify-content-between p-3\\\">\\n\" + \"   <p class=\\\"fw-bold mb-0\\\">\" + sender + \"</p>\\n\" + \"  <p class=\\\"text-muted small mb-0\\\"><i class=\\\"far fa-clock\\\"></i> 12 mins ago</p>\\n\" + \"</div>\\n\" + \"<div class=\\\"card-body\\\">\\n\" + \"   <p class=\\\"mb-0\\\">\" + text + \"</p>\\n\" + \"</div>\\n\" + \"</div>\";\n      } else if (remoteSender) {\n        html = \"<div class=\\\"card w-100\\\">\\n\" + \"<div class=\\\"card-header d-flex justify-content-between p-3\\\">\\n\" + \"<p class=\\\"fw-bold mb-0\\\">\" + remoteSender + \"</p>\\n\" + \"<p class=\\\"text-muted small mb-0\\\"><i class=\\\"far fa-clock\\\"></i> 13 mins ago</p>\\n\" + \"</div>\\n\" + \"<div class=\\\"card-body\\\">\\n\" + \"    <p class=\\\"mb-0\\\">\\n\" + text + \"</p>\\n\" + \"</div>\\n\" + \"</div>\\n\";\n      }\n      this.content += html;\n    },\n    //Add new team members to the chatting list\n    addNewMember(name) {\n      let memberHTML;\n      memberHTML = \"<li class=\\\"p-2 border-bottom\\\" style=\\\"background-color: #eee;\\\">\\n\" + \"<a class=\\\"d-flex justify-content-between\\\">\\n\" + \"<div class=\\\"d-flex flex-row\\\">\\n\" + \"<img src=\\\"/static/UserProfile/user.png\\\" alt=\\\"avatar\\\" class=\\\"rounded-circle d-flex align-self-start me-3 shadow-1-strong\\\" width=\\\"60\\\">\\n\" + \"<div class=\\\"pt-1\\\">\\n\" + \"<p class=\\\"fw-bold mb-0\\\">\" + name + \"</p>\\n\" + \"<p class=\\\"small text-muted\\\">Active Mode</p>\\n\" + \"</div>\\n\" + \"</div>\\n\" + \"<div class=\\\"pt-1\\\">\\n\" + \"<p class=\\\"small text-muted mb-1\\\">Just now</p>\\n\" + \"</div>\\n\" + \"</a>\\n\" + \"</li>\\n\";\n      this.member += memberHTML;\n    }\n  }\n};","map":{"version":3,"mappings":"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","names":["data","userName","message","content","member","users","messages","created","sessionStorage","getItem","mounted","initWebSocket","methods","wsuri","websock","WebSocket","onmessage","websocketonmessage","onopen","websocketonopen","onerror","websocketonerror","onclose","websocketclose","websocketsend","from","to","text","send","JSON","stringify","push","user","addNewContent","console","log","msg","parse","key","addNewMember","close","remoteSender","sender","html","name","memberHTML"],"sourceRoot":"","sources":["C:\\Users\\SuperW\\Desktop\\暑期实习\\vue-frontend\\src\\components\\Others\\Settings\\Communication.vue"],"sourcesContent":["//Adapted By GRPTeam202205 (MIT license)\r\n<template>\r\n    <!-- Group chatting page -->\r\n    <div class=\"container py-5\">\r\n        <div class=\"row\">\r\n            <div class=\"col-md-6 col-lg-5 col-xl-4 mb-4 mb-md-0\">\r\n                <!-- Show online members -->\r\n                <h5 class=\"font-weight-bold mb-3 text-center text-lg-start\">Members</h5>\r\n                <div class=\"card\">\r\n                    <div class=\"container\">\r\n                    <div class=\"card-body\" v-html=\"member\">\r\n                    </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <!-- Show chatting messages -->\r\n            <div class=\"col-md-6 col-lg-7 col-xl-8\" style=\" height:700px; overflow:auto\">\r\n                <ul class=\"d-flex flex-column\" v-html=\"content\">\r\n                </ul>\r\n                <li class=\"bg-white mb-3\">\r\n                    <div class=\"form-outline\">\r\n                        <textarea class=\"form-control\" id=\"textAreaExample2\" rows=\"4\" v-model=\"this.message\"></textarea>\r\n                        <label class=\"form-label\" for=\"textAreaExample2\">{{$t('Message')}}</label>\r\n                    </div>\r\n                </li>\r\n                <button type=\"button\" class=\"btn btn-info btn-rounded float-end\" @click=\"websocketsend\">{{$t('Send')}}</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n    data() {\r\n        return {\r\n            userName: '',\r\n            message: '',\r\n            content: '',\r\n            member: '',\r\n            users: [],\r\n            messages: []\r\n        };\r\n    },\r\n    created(){\r\n        this.userName = sessionStorage.getItem('username')\r\n    },\r\n    mounted() {\r\n        this.initWebSocket()\r\n    },\r\n    methods: {\r\n        initWebSocket(){\r\n            const wsuri = 'ws://120.55.194.201:8085/websocket/'+this.userName     \r\n            this.websock = new WebSocket(wsuri)\r\n            this.websock.onmessage = this.websocketonmessage\r\n            this.websock.onopen = this.websocketonopen\r\n            this.websock.onerror = this.websocketonerror\r\n            this.websock.onclose = this.websocketclose\r\n        },\r\n        //Send messages\r\n        websocketsend(){\r\n            let message = {from: this.userName, to: \"Tom\", text: this.message}\r\n            this.websock.send(JSON.stringify(message))\r\n            this.messages.push({user: this.userName, text: this.message})\r\n            this.addNewContent(null, 'You', this.message)\r\n            this.message = ''\r\n        },\r\n        websocketonopen(){\r\n            console.log(\"Open WebSocket successfully\")\r\n        },\r\n        //Reconnect the websocket if it is not opened successfully\r\n        websocketonerror(){\r\n            this.initWebSocket()\r\n        },\r\n        //Receive messages\r\n        websocketonmessage(msg){\r\n            console.log(msg.data)\r\n            let data = JSON.parse(msg.data)\r\n            if(data.users){//online users\r\n                for(var key in data.users){\r\n                    if(this.users==''){\r\n                        this.addNewMember(data.users[key]['username'])\r\n                    }\r\n                        \r\n                    for(var user in this.users){\r\n                        console.log(this.users[user]['username'])\r\n                        if(data.users[key]['username']!=this.users[user]['username'])\r\n                            this.addNewMember(data.users[key]['username'])\r\n                    }\r\n                }\r\n                this.users = data.users\r\n            }\r\n            else{\r\n                if(data.from!=this.userName)\r\n                    this.addNewContent(data.from, null, data.text)\r\n            }\r\n        },\r\n        //Close the websocket\r\n        websocketclose(){\r\n            this.websock.close()\r\n        },\r\n        //Add chatting content of team members to the chat box\r\n        addNewContent(remoteSender, sender, text){\r\n            let html\r\n            if(sender){\r\n                html =  \r\n                    \"<div class=\\\"card\\\">\\n\"+\r\n                    \"<div class=\\\"card-header d-flex justify-content-between p-3\\\">\\n\"+\r\n                     \"   <p class=\\\"fw-bold mb-0\\\">\"+sender+\"</p>\\n\"+\r\n                      \"  <p class=\\\"text-muted small mb-0\\\"><i class=\\\"far fa-clock\\\"></i> 12 mins ago</p>\\n\"+\r\n                    \"</div>\\n\"+\r\n                    \"<div class=\\\"card-body\\\">\\n\"+\r\n                     \"   <p class=\\\"mb-0\\\">\"+text+\"</p>\\n\"+\r\n                    \"</div>\\n\"+\r\n                    \"</div>\"\r\n            }else if(remoteSender){\r\n                    html = \r\n                            \"<div class=\\\"card w-100\\\">\\n\"+\r\n                            \"<div class=\\\"card-header d-flex justify-content-between p-3\\\">\\n\"+\r\n                                \"<p class=\\\"fw-bold mb-0\\\">\"+remoteSender+\"</p>\\n\"+\r\n                                \"<p class=\\\"text-muted small mb-0\\\"><i class=\\\"far fa-clock\\\"></i> 13 mins ago</p>\\n\"+\r\n                            \"</div>\\n\"+\r\n                            \"<div class=\\\"card-body\\\">\\n\"+\r\n                            \"    <p class=\\\"mb-0\\\">\\n\"+ text + \"</p>\\n\"+\r\n                            \"</div>\\n\"+\r\n                        \"</div>\\n\"\r\n            }\r\n            this.content+=html\r\n        },\r\n        //Add new team members to the chatting list\r\n        addNewMember(name){\r\n            let memberHTML\r\n            memberHTML = \r\n                    \"<li class=\\\"p-2 border-bottom\\\" style=\\\"background-color: #eee;\\\">\\n\"+\r\n                        \"<a class=\\\"d-flex justify-content-between\\\">\\n\"+\r\n                            \"<div class=\\\"d-flex flex-row\\\">\\n\"+\r\n                                \"<img src=\\\"/static/UserProfile/user.png\\\" alt=\\\"avatar\\\" class=\\\"rounded-circle d-flex align-self-start me-3 shadow-1-strong\\\" width=\\\"60\\\">\\n\"+\r\n                                \"<div class=\\\"pt-1\\\">\\n\"+\r\n                                    \"<p class=\\\"fw-bold mb-0\\\">\"+name+\"</p>\\n\"+\r\n                                    \"<p class=\\\"small text-muted\\\">Active Mode</p>\\n\"+\r\n                                \"</div>\\n\"+\r\n                            \"</div>\\n\"+\r\n                            \"<div class=\\\"pt-1\\\">\\n\"+\r\n                                \"<p class=\\\"small text-muted mb-1\\\">Just now</p>\\n\"+\r\n                            \"</div>\\n\"+\r\n                        \"</a>\\n\"+\r\n                    \"</li>\\n\"\r\n            this.member+=memberHTML\r\n        }\r\n    }\r\n}\r\n</script>\r\n\r\n<style>\r\n\r\n</style>"]},"metadata":{},"sourceType":"module","externalDependencies":[]}